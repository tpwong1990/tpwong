{% extends "layout.html" %}

{% block title %}
    Summary
{% endblock %}

{% block main %}
<script>
    function select_save_auto_sumbit(select_key, val){
            //console.log(val)
            console.log(select_key)
            sessionStorage.setItem(select_key, val);
            //console.log(sessionStorage.getItem('SelectedItem'));
            document.getElementById("month_select").submit();
        }

    function load_selected(select_key){
        let tmp = sessionStorage.getItem(select_key);
        //console.log(tmp);
        return tmp
    }

    function set_selected_option(select_id, select_key){
        var mySelect = document.getElementById(select_id);
        for(var i, j = 0; i = mySelect.options[j]; j++) {
        if(i.value == load_selected(select_key)) {
            mySelect.selectedIndex = j;
            break;
        }
    }
    }

</script>
<form action="/select", method = "post", id="month_select" name="month_select">
<table class="table">
    <thread>
        <tr>
            <th>Day</th>
            <th>Month</th>
            <th>Year</th>
            <th>Name</th>
            <th>Category</th>
            <th>Expense</th>
            <th>Remarks</th>
            <th></th>
        </tr>
    </thread>
    <tbody>
        <tr>
            <td></td>
            <td>
                <select class="form-select mx-auto w-auto" id="month" name="month" onchange="select_save_auto_sumbit('month_key', this.value)">
                    <option value ='All'>All</option>
                    {% for mon in d_months %}
                        <option value = {{ mon[0] }} >{{ mon[0] }}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select class="form-select mx-auto w-auto" id="year" name="year" onchange="select_save_auto_sumbit('year_key', this.value)">
                    <option value ='All'>All</option>
                    {% for yr in d_years %}
                        <option value = {{ yr[0] }} >{{ yr[0] }}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select class="form-select mx-auto w-auto" id="name" name="name" onchange="select_save_auto_sumbit('name_key', this.value)">
                    <option value ='All'>All</option>
                    {% for na in d_names %}
                        <option value = {{ na[0] }} >{{ na[0] }}</option>
                    {% endfor %}
                </select>
            </td>
            <td>
                <select class="form-select mx-auto w-auto" id="category" name="category" onchange="select_save_auto_sumbit('category_key', this.value)">
                    <option value ='All'>All</option>
                    {% for ca in d_categories %}
                        <option value = {{ ca[0] }} >{{ ca[0] }}</option>
                    {% endfor %}
                </select>
            </td>
            <td></td>
            <td></td>
        </tr>
        {% for exp in expenses %}
            </tr>
                <td>{{ exp[1] }}</td>
                <td>{{ exp[2] }}</td>
                <td>{{ exp[3] }}</td>
                <td>{{ exp[5] }}</td>
                <td>{{ exp[4] }}</td>
                <td>{{ exp[6] }}</td>
                <td>{{ exp[7] }}</td>
                <td><button class="btn btn-primary" type="submit" id="delete" name ="delete" value = {{ exp[0] }}>Delete</button></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
</form>

<script>
    if ({{ load_option }} == 1) {
        set_selected_option("month", 'month_key')
        set_selected_option("year", 'year_key')
        set_selected_option("name", 'name_key')
        set_selected_option("category", 'category_key')
    }
    //window.location.reload();
    //sessionStorage.clear();
</script>

    {% with messages = get_flashed_messages() %}
        {% if messages %}
                {% for message in messages %}
                    <script>window.alert({{ message|tojson }} );</script>
                {% endfor %}
        {% endif %}
    {% endwith %}

{% endblock %}